import React from "react";
import { API_BASE_URL2 } from "../api";
import { Card, Text } from "../../components";

const MetricItem = ({
  label,
  value,
  valueColor,
  isPrimary = false,
  isLarge = false,
}) => {
  const containerStyle = {
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center",
    padding: "0.6rem 0.2rem 0 0.2rem",
    borderBottom: !isPrimary ? "1px solid #f3f4f6" : "none",
  };

  const labelStyle = {
    color: "#374151",
    fontWeight: "500",
    fontSize: isLarge ? "1.125rem" : "1rem",
  };

  let finalValueColor = "#1f2937";
  if (valueColor === "text-green-800") finalValueColor = "#000000ff";
  else if (valueColor === "text-green-600") finalValueColor = "#000000ff";
  else if (valueColor === "text-red-600") finalValueColor = "#000000ff";

  return (
    <div style={containerStyle}>
      <span style={labelStyle}>{label}</span>

      <span
        style={{
          fontWeight: "bold",
          fontSize: isLarge ? "1.1rem" : "1rem",
          color: finalValueColor,
        }}
      >
        {(() => {
          // Remove commas and convert to number
          const cleaned = (value || "").toString().replace(/,/g, "");
          const num = Number(cleaned);

          // If not a valid number, show raw string WITHOUT ₹ sign
          if (isNaN(num)) {
            return value; // directly show string value
          }

          // Otherwise, show formatted number WITH ₹ sign
          return (
            <>
              <span style={{ fontFamily: "sans-serif" }}>₹</span>
              {num >= 1000000
                ? (num / 1000000).toFixed(1) + "M"
                : num.toFixed(1)}
            </>
          );
        })()}
      </span>
    </div>
  );
};

const ProductCard = ({ productData, onBuy }) => {
  const {
    title,
    price,
    dailyEarnings,
    totalGain,
    durationDays,
    cycleType,
    img,
    isdailyClaim,
  } = productData;

  return (
    <Card className="relative w-full min-h-[33vh] bg-yellow-50 overflow-hidden border border-gray-700">
      {/* Orange badge */}
      <div className="absolute top-0 left-0 bg-orange-500 text-white text-xs font-semibold px-4 py-1 rounded-br-4xl shadow-md">
        {durationDays} {cycleType === "hour" ? "Hours" : "Days"}
      </div>

      <div className="pt-2">
        {/* Product image */}
        <div className="w-full h-[18vh] bg-red-200 rounded-lg flex items-center justify-center overflow-hidden">
          <img
            src={`${API_BASE_URL2}${img}`}
            alt="Product"
            className="w-full h-full object-cover"
            onError={(e) => {
              e.target.onerror = null;
              e.target.src =
                "https://placehold.co/150x150/9ca3af/fff?text=Product";
            }}
          />
        </div>

        {/* Product Info */}
        <div className="pt-2">
          <Text variant="h3">{title}</Text>

          <MetricItem
            label="Plan Price"
            value={price}
            valueColor="text-green-800"
            isPrimary
          />
          <MetricItem
            label={cycleType === "hour" ? "Hours Earning" : "Days Earning"}
            value={dailyEarnings}
            valueColor="text-green-600"
          />
          <MetricItem
            label="Total Earning"
            value={totalGain}
            valueColor="text-red-600"
            isPrimary
            isLarge
          />
        </div>
      </div>

      <div className="py-2 px-0 bg-yellow-50 flex justify-center">
        <button className="buy-button" onClick={onBuy}>
          BUY NOW
        </button>
      </div>
    </Card>
  );
};

export default ProductCard;
